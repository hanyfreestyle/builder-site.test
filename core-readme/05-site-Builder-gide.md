# دليل استخدام Site Builder

## مقدمة

يقدم هذا الدليل شرحًا شاملاً لكيفية استخدام نظام Site Builder المبني على Laravel و Filament. ينقسم الدليل إلى قسمين رئيسيين:
1. **لوحة التحكم**: طريقة إنشاء وإدارة القوالب والبلوكات والصفحات والقوائم
2. **الواجهة الأمامية**: طريقة عرض الموقع للزوار وكيفية تفاعل المكونات المختلفة

## الجزء الأول: لوحة التحكم

### 1. إدارة القوالب (Templates)

القوالب هي البنية الأساسية لتصميم الموقع بأكمله. كل قالب له تصميم ومظهر مختلف ويدعم مجموعة من البلوكات وإصدارات العرض المختلفة.

#### 1.1 إنشاء قالب جديد

1. انتقل إلى قسم "القوالب" في لوحة التحكم
2. اضغط على زر "إنشاء"
3. أدخل المعلومات الأساسية للقالب:
   - **الاسم**: اسم وصفي للقالب (مثل "قالب مطعم"، "قالب وكالة")
   - **المعرف الفريد (Slug)**: معرف فريد للقالب يستخدم في المسارات ومجلدات القوالب
   - **الوصف**: وصف مختصر للقالب وحالات الاستخدام المثالية له
   - **اللغات المدعومة**: اختر اللغات التي يدعمها هذا القالب
   - **الصورة المصغرة**: صورة توضيحية للقالب تظهر في صفحة اختيار القوالب
   - **اللون الرئيسي**: لون أساسي للقالب يستخدم في التصميم
   - **اللون الثانوي**: لون ثانوي مكمل للون الرئيسي
   - **الخط الأساسي**: نوع الخط المستخدم للعناوين والنصوص الرئيسية
   - **الخط الثانوي**: نوع الخط المستخدم للنصوص العادية

4. اضغط على زر "حفظ" لإنشاء القالب

#### 1.2 ربط أنواع البلوكات بالقالب

بعد إنشاء القالب، يجب تحديد أنواع البلوكات التي سيدعمها وإصدارات العرض لكل نوع:

1. انتقل إلى صفحة تعديل القالب
2. اضغط على تبويب "أنواع البلوكات"
3. اضغط على "إضافة نوع بلوك"
4. اختر نوع البلوك من القائمة المنسدلة
5. حدد إصدارات العرض المتاحة لهذا النوع في القالب:
   - أضف كل إصدار عرض متاح (مثل "default"، "centered"، "with-video")
   - حدد الإصدار الافتراضي الذي سيتم استخدامه تلقائيًا

6. كرر العملية لجميع أنواع البلوكات التي تريد دعمها في هذا القالب

> **ملاحظة مهمة**: يجب إنشاء ملفات العرض المناسبة في مجلد القالب قبل استخدام إصدارات العرض. ملفات العرض تكون في مسار `resources/views/templates/{template_slug}/blocks/{block_type}/{version}.blade.php`.

### 2. إدارة أنواع البلوكات (Block Types)

أنواع البلوكات هي المكونات الأساسية التي يمكن إضافتها إلى الصفحات. كل نوع له بنية بيانات (schema) ثابتة ولكن يمكن عرضه بطرق مختلفة حسب القالب.

#### 2.1 إنشاء نوع بلوك جديد

1. انتقل إلى قسم "أنواع البلوكات" في لوحة التحكم
2. اضغط على زر "إنشاء"
3. أدخل المعلومات الأساسية لنوع البلوك:
   - **الاسم**: اسم وصفي للبلوك (مثل "Hero"، "Features"، "Testimonials")
   - **المعرف الفريد (Slug)**: معرف فريد يستخدم في التعامل مع البلوك وملفات العرض
   - **الأيقونة**: أيقونة تعبر عن البلوك لتسهيل التعرف عليه
   - **فئة البلوك**: فئة تصنيفية للبلوك (أساسي، وسائط، متقدم)
   - **الوصف**: وصف مختصر لوظيفة البلوك وكيفية استخدامه

4. قم بإنشاء بنية البلوك (Schema) بإضافة الحقول المطلوبة:
   - اضغط على "إضافة حقل"
   - لكل حقل، حدد:
     - **اسم الحقل**: اسم تعريفي للحقل (مثل "title", "subtitle", "image")
     - **عنوان الحقل**: العنوان الظاهر في نموذج الإدخال
     - **نوع الحقل**: نوع البيانات (نص، نص طويل، صورة، رابط، الخ)
     - **هل الحقل مطلوب؟**: حدد إذا كان الحقل إلزامي أم لا
     - **قابل للترجمة؟**: حدد إذا كان الحقل يدعم تعدد اللغات
     - **عرض الحقل**: حدد نسبة عرض الحقل في الشاشة (كامل، نصف، ثلث)
     - **ترتيب الحقل**: ترتيب ظهور الحقل في النموذج

5. أضف القيم الافتراضية للحقول (اختياري)
6. اضغط على زر "حفظ" لإنشاء نوع البلوك

#### 2.2 إنشاء ملفات العرض للبلوك

بعد إنشاء نوع البلوك، يجب إنشاء ملفات العرض المناسبة:

1. **العرض الافتراضي العام** (Fallback):
   - أنشئ ملف في `resources/views/blocks/{block_slug}/default.blade.php`

2. **إصدارات العرض المخصصة لكل قالب**:
   - أنشئ ملفات في `resources/views/templates/{template_slug}/blocks/{block_slug}/{version}.blade.php`

مثال لمحتوى ملف عرض بلوك Hero:

```blade
<div class="hero-block {{ $class ?? '' }}">
    <div class="container">
        <h1 class="hero-title">{{ $block->getData('title') }}</h1>
        @if($block->getData('subtitle'))
            <p class="hero-subtitle">{{ $block->getData('subtitle') }}</p>
        @endif
        
        @if($block->getData('link1'))
            <a href="{{ $block->getData('link1')['url'] }}" class="btn btn-primary">
                {{ $block->getData('link1')['text'] }}
            </a>
        @endif
        
        @if($block->getData('photo'))
            <img src="{{ Storage::url($block->getData('photo')) }}" alt="{{ $block->getData('title') }}" class="hero-image">
        @endif
    </div>
</div>
```

### 3. إدارة الصفحات (Pages)

الصفحات هي المحتوى الفعلي للموقع وتحتوي على مجموعة من البلوكات المرتبة حسب الحاجة.

#### 3.1 إنشاء صفحة جديدة

1. انتقل إلى قسم "الصفحات" في لوحة التحكم
2. اضغط على زر "إنشاء"
3. أدخل المعلومات الأساسية للصفحة:
   - **العنوان**: عنوان الصفحة الذي سيظهر في المتصفح والقوائم
   - **المعرف الفريد (Slug)**: معرف فريد للصفحة يستخدم في الرابط (URL)
   - **القالب**: اختر القالب الذي ستستخدمه الصفحة
   - **الحالة**: حدد ما إذا كانت الصفحة منشورة أو مسودة
   - **صفحة البداية؟**: حدد ما إذا كانت هذه هي الصفحة الرئيسية للموقع
   - **معلومات SEO**: أدخل بيانات تحسين محركات البحث:
     - العنوان المخصص (إذا كان مختلفًا عن عنوان الصفحة)
     - الوصف
     - الكلمات المفتاحية

4. اضغط على زر "حفظ" لإنشاء الصفحة

#### 3.2 إضافة البلوكات إلى الصفحة

بعد إنشاء الصفحة، يمكنك إضافة البلوكات إليها:

1. انتقل إلى صفحة تعديل الصفحة
2. اضغط على تبويب "البلوكات"
3. اضغط على "إضافة بلوك"
4. اختر نوع البلوك من القائمة المنسدلة
5. أدخل بيانات البلوك في الحقول المعروضة:
   - النموذج سيعرض الحقول حسب بنية نوع البلوك (schema)
   - إذا كان هناك دعم لتعدد اللغات، ستظهر تبويبات لكل لغة
6. اختر إصدار العرض المطلوب من القائمة المنسدلة
7. حدد ترتيب البلوك (ترتيب العرض في الصفحة)
8. اضغط على زر "حفظ" لإضافة البلوك

9. كرر العملية لإضافة المزيد من البلوكات حسب الحاجة
10. يمكنك تغيير ترتيب البلوكات بالسحب والإفلات

### 4. إدارة القوائم (Menus)

القوائم تساعد في تنظيم روابط التنقل في الموقع وتوجيه الزوار.

#### 4.1 إنشاء قائمة جديدة

1. انتقل إلى قسم "القوائم" في لوحة التحكم
2. اضغط على زر "إنشاء"
3. أدخل المعلومات الأساسية للقائمة:
   - **الاسم**: اسم وصفي للقائمة (مثل "القائمة الرئيسية"، "قائمة التذييل")
   - **المعرف الفريد (Slug)**: معرف فريد للقائمة
   - **الموقع**: حدد موقع القائمة في الموقع (ترويسة، تذييل، جانبي)
   - **القالب**: اختر القالب الذي سترتبط به هذه القائمة

4. اضغط على زر "حفظ" لإنشاء القائمة

#### 4.2 إضافة عناصر إلى القائمة

بعد إنشاء القائمة، يمكنك إضافة عناصر إليها:

1. انتقل إلى صفحة تعديل القائمة
2. اضغط على تبويب "عناصر القائمة"
3. اضغط على "إضافة عنصر"
4. أدخل بيانات العنصر:
   - **العنوان**: النص الذي سيظهر للعنصر
   - **نوع العنصر**: اختر من:
     - **رابط خارجي**: رابط لموقع خارجي
     - **صفحة**: رابط لصفحة داخلية (سيظهر منسدل لاختيار الصفحة)
     - **مسار**: رابط مخصص داخلي
     - **قسم**: عنصر قسم (فاصل أو عنوان)
   - **الرابط**: أدخل الرابط حسب نوع العنصر المختار
   - **العنصر الأب**: اختر ما إذا كان هذا العنصر فرعيًا لعنصر آخر (للقوائم متعددة المستويات)
   - **ترتيب العنصر**: ترتيب ظهور العنصر في القائمة
   - **إظهار للمستخدمين المسجلين فقط؟**: خيار لتحديد رؤية العنصر للمستخدمين المسجلين فقط

5. اضغط على زر "حفظ" لإضافة العنصر
6. كرر العملية لإضافة المزيد من العناصر
7. يمكنك تغيير ترتيب العناصر بالسحب والإفلات

## الجزء الثاني: الواجهة الأمامية

### 1. طريقة عرض الصفحات

#### 1.1 آلية العرض الأساسية

عندما يزور المستخدم صفحة، يتم تنفيذ الخطوات التالية:

1. المتصفح يطلب الصفحة من خلال الرابط (مثل `/ar/about-us`)
2. `PageController` يتلقى الطلب ويقوم بـ:
   - تحديد اللغة الحالية من خلال `LocaleMiddleware`
   - البحث عن الصفحة المطلوبة بواسطة المعرف (slug)
   - الحصول على القالب المرتبط بالصفحة
   - تجهيز بيانات القوائم المرتبطة بالقالب
   - ترتيب البلوكات حسب ترتيبها المحدد

3. يتم تحميل قالب التخطيط العام للقالب (`templates/{template}/layout.blade.php`)
4. داخل التخطيط، يتم تحميل قالب الصفحة (`templates/{template}/page.blade.php`)
5. داخل قالب الصفحة، يتم عرض البلوكات بالترتيب:
   - لكل بلوك، يتم استدعاء `BlockRenderer` لعرض البلوك
   - `BlockRenderer` يحدد ملف العرض المناسب بناءً على:
     - نوع البلوك
     - القالب المستخدم
     - إصدار العرض المحدد للبلوك

6. يتم تحميل ملف العرض لكل بلوك وتمرير بيانات البلوك إليه

#### 1.2 نظام العرض المرن

ميزة نظام Site Builder الأساسية هي نظام العرض المرن. البلوك الواحد يمكن عرضه بطرق مختلفة حسب:

1. **القالب المستخدم**: كل قالب يمكن أن يعرض نفس البلوك بطريقة مختلفة
2. **إصدار العرض المحدد**: البلوك الواحد يمكن أن يكون له إصدارات عرض متعددة ضمن نفس القالب

آلية البحث عن ملف العرض المناسب تتبع التسلسل التالي:

1. البحث عن ملف خاص بالقالب وإصدار العرض: `templates/{template}/blocks/{block_type}/{version}.blade.php`
2. إذا لم يوجد، البحث عن الإصدار الافتراضي للقالب: `templates/{template}/blocks/{block_type}/default.blade.php`
3. إذا لم يوجد، استخدام الملف العام: `blocks/{block_type}/{version}.blade.php`
4. إذا لم يوجد، استخدام الملف العام الافتراضي: `blocks/{block_type}/default.blade.php`

هذا التسلسل يضمن وجود fallback دائمًا لعرض البلوك.

### 2. دعم تعدد اللغات

#### 2.1 آلية تبديل اللغات

النظام يدعم تعدد اللغات بشكل كامل:

1. اللغات المدعومة تحدد في ملف `config/laravellocalization.php`
2. كل قالب يمكن أن يدعم مجموعة فرعية من اللغات المتاحة
3. الروابط تتضمن رمز اللغة (`/ar/about-us`, `/en/about-us`)
4. `LocaleMiddleware` يضبط اللغة الحالية بناءً على الرابط
5. مكون `language-switcher` يعرض قائمة تبديل اللغات المتاحة للقالب الحالي

#### 2.2 الحقول المترجمة

الحقول في البلوكات يمكن تعريفها كقابلة للترجمة. عند تعديل بيانات البلوك:

1. الحقول القابلة للترجمة تظهر في تبويبات منفصلة لكل لغة
2. الحقول غير القابلة للترجمة (مثل الصور) تظهر مرة واحدة فقط

عند عرض البلوك في الواجهة الأمامية، يتم استخدام الدالة `getData()` لاسترجاع بيانات الحقل حسب اللغة الحالية تلقائيًا.

### 3. القوائم والتنقل

#### 3.1 عرض القوائم

القوائم تعرض حسب موقعها المحدد في قالب التخطيط العام:

```blade
<!-- في ملف layout.blade.php -->
<header>
    @include('templates.'.$template->slug.'.partials.menu', ['location' => 'header'])
</header>

<footer>
    @include('templates.'.$template->slug.'.partials.menu', ['location' => 'footer'])
</footer>
```

ملف `menu.blade.php` الجزئي يعرض القائمة المناسبة حسب الموقع ويدعم عناصر متعددة المستويات.

#### 3.2 القوائم الديناميكية

تتميز القوائم بأنها:

1. **مرتبطة بالقالب**: كل قالب له قوائمه الخاصة
2. **متعددة المستويات**: تدعم القوائم الفرعية
3. **ديناميكية الروابط**: عند تغيير معرف (slug) صفحة، تتحدث الروابط تلقائيًا
4. **متعددة اللغات**: الروابط الداخلية تعكس اللغة الحالية تلقائيًا

### 4. الاستجابة للأجهزة المختلفة (Responsive Design)

نظام Site Builder مصمم ليعمل بشكل متوافق مع مختلف أحجام الشاشات:

1. **قوالب متجاوبة**: جميع القوالب تستخدم تقنيات CSS الحديثة للتوافق مع مختلف الأجهزة
2. **صور متجاوبة**: نظام الصور يدعم أحجام مختلفة للصور حسب حجم الشاشة
3. **قوائم متكيفة**: القوائم تتحول إلى نمط الهامبرغر على الشاشات الصغيرة

## أمثلة عملية

### 1. إنشاء موقع بسيط بثلاث صفحات

#### الخطوة 1: اختيار القالب المناسب
1. استخدم قالب "الوكالة" لموقع شركة
2. تأكد من اختيار اللغات المناسبة للقالب

#### الخطوة 2: إنشاء الصفحات
1. إنشاء الصفحة الرئيسية (تفعيل خيار "صفحة البداية")
2. إنشاء صفحة "من نحن"
3. إنشاء صفحة "اتصل بنا"

#### الخطوة 3: إضافة البلوكات للصفحة الرئيسية
1. إضافة بلوك Hero (إصدار "full-width")
2. إضافة بلوك الخدمات
3. إضافة بلوك آراء العملاء
4. إضافة بلوك الشركاء

#### الخطوة 4: إنشاء القوائم
1. إنشاء قائمة رئيسية للترويسة
2. إضافة روابط للصفحات الثلاث
3. إنشاء قائمة التذييل مع روابط إضافية

### 2. تخصيص عرض بلوك محدد

لتخصيص طريقة عرض بلوك Hero في قالب الوكالة:

1. أنشئ ملف `resources/views/templates/agency/blocks/hero/animated.blade.php`
2. أضف كود العرض المخصص بالتأثيرات المتحركة
3. أضف إصدار "animated" في ربط نوع بلوك Hero بقالب الوكالة
4. عند إضافة بلوك Hero لصفحة، اختر إصدار العرض "animated"

## نصائح وأفضل الممارسات

1. **البدء بالتخطيط**:
   - حدد هيكل الموقع والصفحات المطلوبة قبل البدء
   - خطط لأنواع البلوكات التي ستحتاجها

2. **تنظيم البلوكات**:
   - استخدم فئات البلوكات لتنظيمها (أساسي، وسائط، متقدم)
   - ضع أسماء وصفية واضحة لتسهيل الاستخدام

3. **استخدام البلوكات بشكل متناسق**:
   - استخدم نفس نوع البلوك بطرق متشابهة عبر الصفحات للحفاظ على تناسق التصميم
   - انتبه لترتيب البلوكات لضمان تدفق منطقي للمحتوى

4. **تخصيص القوالب**:
   - ابدأ بتخصيص ملفات العرض الخاصة بالبلوكات الأكثر استخدامًا
   - تأكد من اختبار التخصيصات على مختلف أحجام الشاشات

5. **دعم تعدد اللغات**:
   - حدد اللغات المدعومة في بداية المشروع
   - تأكد من ترجمة جميع النصوص الثابتة في ملفات العرض

## خاتمة

نظام Site Builder يوفر بنية مرنة وقوية لإنشاء مواقع متعددة ومتنوعة بدون الحاجة لكتابة الكود من الصفر في كل مرة. بفضل مفهوم البنية الموحدة والعرض المرن، يمكن إعادة استخدام أنواع البلوكات نفسها مع قوالب مختلفة ومظاهر متنوعة.

هذا النهج يحقق توازنًا مثاليًا بين:
- **المرونة**: تخصيص كل جانب من جوانب الموقع
- **القابلية للتوسع**: إضافة أنواع بلوكات وقوالب جديدة بسهولة
- **قابلية الصيانة**: تحديث مظهر الموقع بالكامل بمجرد تغيير القالب
- **سهولة الاستخدام**: واجهة إدارة بديهية للمستخدمين غير التقنيين